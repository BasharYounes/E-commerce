# نظام التوصيات المطوّر مع ميزة المتابعة

## نظرة عامة
تم تطوير نظام التوصيات لاستغلال ميزة متابعة المستخدمين، حيث يتم عرض إعلانات المستخدمين الذين يتابعهم المستخدم الحالي في التوصيات.

## التحديثات المنجزة

### 1. إضافة دالة جديدة في AdvRepository
```php
public function getFollowingUsersAds($userId, $adsPerUser = 3, $excludeIds = [])
```
- تجلب إعلانات المستخدمين الذين يتابعهم المستخدم الحالي
- تأخذ 3 إعلانات على الأقل من كل مستخدم يتابعه
- تستبعد الإعلانات المحددة مسبقاً لتجنب التكرار

### 2. تطوير تابع getGeneralRecommendations
- **عند عدم وجود نشاطات للمستخدم:**
  - يجلب إعلانات المتابعين أولاً (3 إعلانات من كل متابع)
  - يملأ باقي العدد المطلوب بالتوصيات العامة
  - يتجنب عرض الإعلانات المكررة

### 3. تطوير تابع getSmartRecommendations
- **عند وجود نشاطات للمستخدم:**
  - يجلب التوصيات الذكية بناءً على النشاطات
  - يجلب إعلانات المتابعين
  - يدمج الاثنين معاً مع إعطاء أولوية لإعلانات المتابعين

### 4. إضافة دالة دمج مساعدة
```php
private function mergeFollowingAdsWithRecommendations($smartAds, $followingAds, $limit)
```
- تدمج إعلانات المتابعين مع التوصيات الذكية
- تعطي أولوية لإعلانات المتابعين
- تتجنب التكرار
- تملأ العدد المطلوب بالتوصيات العامة إذا لزم الأمر

## خوارزمية العمل

### السيناريو الأول: لا يوجد نشاطات للمستخدم
1. جلب إعلانات المتابعين (3 من كل متابع)
2. إضافة التوصيات العامة لملء العدد المطلوب
3. تجنب التكرار
4. إرجاع النتائج

### السيناريو الثاني: يوجد نشاطات للمستخدم
1. جلب التوصيات الذكية بناءً على النشاطات
2. جلب إعلانات المتابعين
3. دمج الاثنين مع إعطاء أولوية للمتابعين
4. إضافة توصيات عامة إذا لم يكتمل العدد
5. إرجاع النتائج

## المميزات
- **أولوية للمتابعين:** إعلانات المتابعين تظهر أولاً
- **تجنب التكرار:** لا يظهر نفس الإعلان مرتين
- **مرونة في العدد:** يضمن الحصول على العدد المطلوب من التوصيات
- **دمج ذكي:** يجمع بين التوصيات الذكية وإعلانات المتابعين

## مثال على الاستخدام
```php
// عند استدعاء التوصيات
$recommendations = $recommendedController->index($request);

// النتيجة ستشمل:
// 1. إعلانات المتابعين (إذا كان يتابع أحداً)
// 2. التوصيات الذكية (إذا كان له نشاطات)
// 3. التوصيات العامة (لإكمال العدد المطلوب)
```

## الفوائد
- تحسين تجربة المستخدم من خلال عرض محتوى من الأشخاص الذين يهتم بهم
- زيادة التفاعل مع المحتوى
- استغلال أفضل لشبكة المتابعة في التطبيق
